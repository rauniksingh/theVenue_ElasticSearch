{"version":3,"sources":["../../src/factories/createRoarrInititialGlobalState.js"],"names":["currentState","versions","concat","sort","cmp","currentIsLatestVersion","length","version","includes","push","newState","buffer","prepend","sequence","write","Writer","bufferSize","ROARR_BUFFER_SIZE","stream","ROARR_STREAM","flush"],"mappings":";;;;;;;AAEA;;AACA;;AAMA;;AAIA;;;;;;;;AAEA;+EACgBA,Y,EAA+C;AAC7D,MAAMC,QAAQ,GAAG,CAACD,YAAY,CAACC,QAAb,IAAyB,EAA1B,EAA8BC,MAA9B,EAAjB;AAEAD,EAAAA,QAAQ,CAACE,IAAT,CAAcC,sBAAd;AAEA,MAAMC,sBAAsB,GAAG,CAACJ,QAAQ,CAACK,MAAV,IAAoB,4BAAIC,gBAAJ,EAAaN,QAAQ,CAACA,QAAQ,CAACK,MAAT,GAAkB,CAAnB,CAArB,MAAgD,CAAnG;;AAEA,MAAI,CAACL,QAAQ,CAACO,QAAT,CAAkBD,gBAAlB,CAAL,EAAiC;AAC/BN,IAAAA,QAAQ,CAACQ,IAAT,CAAcF,gBAAd;AACD;;AAEDN,EAAAA,QAAQ,CAACE,IAAT,CAAcC,sBAAd;;AAEA,MAAMM,QAAQ;AACZC,IAAAA,MAAM,EAAE,EADI;AAEZC,IAAAA,OAAO,EAAE,EAFG;AAGZC,IAAAA,QAAQ,EAAE;AAHE,KAITb,YAJS;AAKZC,IAAAA;AALY,IAAd;;AAQA,MAAII,sBAAsB,IAAI,CAACK,QAAQ,CAACI,KAAxC,EAA+C;AAC7C,QAAMC,MAAM,GAAG,2BAAa;AAC1BC,MAAAA,UAAU,EAAEC,yBADc;AAE1BC,MAAAA,MAAM,EAAEC;AAFkB,KAAb,CAAf;AAKAT,IAAAA,QAAQ,CAACI,KAAT,GAAiBC,MAAM,CAACD,KAAxB;AACAJ,IAAAA,QAAQ,CAACU,KAAT,GAAiBL,MAAM,CAACK,KAAxB;AACD;;AAED,SAAOV,QAAP;AACD,C","sourcesContent":["// @flow\n\nimport cmp from 'semver-compare';\nimport {\n  version\n} from '../../package.json';\nimport type {\n  RoarrGlobalStateType\n} from '../types';\nimport {\n  ROARR_BUFFER_SIZE,\n  ROARR_STREAM\n} from '../config';\nimport createWriter from './createWriter';\n\n// eslint-disable-next-line flowtype/no-weak-types\nexport default (currentState: Object): RoarrGlobalStateType => {\n  const versions = (currentState.versions || []).concat();\n\n  versions.sort(cmp);\n\n  const currentIsLatestVersion = !versions.length || cmp(version, versions[versions.length - 1]) === 1;\n\n  if (!versions.includes(version)) {\n    versions.push(version);\n  }\n\n  versions.sort(cmp);\n\n  const newState = {\n    buffer: '',\n    prepend: {},\n    sequence: 0,\n    ...currentState,\n    versions\n  };\n\n  if (currentIsLatestVersion || !newState.write) {\n    const Writer = createWriter({\n      bufferSize: ROARR_BUFFER_SIZE,\n      stream: ROARR_STREAM\n    });\n\n    newState.write = Writer.write;\n    newState.flush = Writer.flush;\n  }\n\n  return newState;\n};\n"],"file":"createRoarrInititialGlobalState.js"}